<app-header></app-header>>

<main class="page-wrapper">
    <app-sidebar></app-sidebar>

    <section class="inner-wrapper">
        <div class="col-sm-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h1>Orders Management</h1>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="back-search">
                            <div class="col-sm-2">
                                <label style="width: 100%;">Order No:</label>
                                <input type="text" id="order_no" style="width: 100%;" class="form-control filter_input" >
                            </div>
                            <div class="col-sm-2">
                                <label style="width: 100%;">Teacher Phone:</label>
                                <input type="text" id="teacher_data" style="width: 100%;" class="form-control filter_input" >
                            </div>
                            <div class="col-sm-2">
                                <label style="width: 100%;">Student Phone:</label>
                                <input type="text" id="student_data" style="width: 100%;" class="form-control filter_input" >
                            </div>
                            <div class="col-sm-2">
                                <label style="width: 100%;">Tutor Accept Status:</label>
                                <select id="teacher_accept_status" class="form-control" >
                                    <option value="">Tutor Accept Status</option>
                                    <option value="Accepted">Accepted</option>
                                    <option value="Declined">Declined</option>
                                    <option value="Pending">Pending</option>
                                </select>
                            </div>
                              <div class="col-sm-2">
                                <label style="width: 100%;">From:</label><input type="date" id="start_date" style="width: 100%;" class="form-control filter_input" >
                            </div>
                            <div class="col-sm-2"><label style="width: 100%;">To:</label><input type="date" id="end_date"style="width: 100%;" class="form-control filter_input" >
                            </div>
                              
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="back-search">
                            <div class="col-sm-2">
                                <label style="width: 100%;">Payment Status:</label>
                                <select id="payment_status" class="form-control" >
                                    <option value="">Payment Status</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Pending">Pending</option>
                                </select>
                            </div>
                            <div class="col-sm-2"></div>
                            <div class="col-sm-2"></div>
                              <div class="col-sm-6">
                                <label style="width: 100%;">&nbsp;</label><a (click)="searchData()" id="searchStudentBtn" class="btn btn-info">Search</a>
                                <a (click)="reset()" style="margin-left:6px;" class="btn btn-info">Reset</a>
                                <a *ngIf="login_user_type == 'Admin' || export_p == 'YES'" style="margin-left:6px;" (click)="exportCSV()" id="exportBtn" class="btn btn-info">Export</a>
                                <a data-toggle="modal" style="margin-left:6px;" data-target="#basicModal" class="btn btn-info">Create Order</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 text-right">
                            <div class="paging_bootstrap pagination">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="table-responsive widthFixed">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th width="62px">S No.</th>
                                            <th width="130px">Order No.</th>
                                            <th width="130px">User Details</th>
                                            <th width="130px">Teacher Details</th>
                                            <th width="130px">Tutor Accept</th>
                                            <th width="130px">Booking Details</th>
                                            <th width="130px">Package Details</th>
                                            <th width="130px">Total Amount</th>
                                            <th width="130px">Order Date</th>
                                            <th>Action</th>
                                           
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let order of orders | paginate: { itemsPerPage: 10, currentPage: p, totalItems: total } ; let i = index" [attr.data-index]="i" class="odd">
                                            <td>{{ i+1 }}.</td>
                                            <td><a style="color:blue" [routerLink]="['/view-order-details/', order.id  ]" >{{ order?.order_no }}</a></td>
                                            <td>
                                              <strong>{{ order?.student_name }}</strong><br />
                                              {{ order?.student_email }}<br />
                                              {{ order?.student_phone }}
                                            </td>
                                            <td>
                                                <strong>{{ order?.tutor_name }}</strong><br />
                                                {{ order?.tutor_email }}<br />
                                                {{ order?.tutor_phone }}
                                              </td>
                                            <td><span *ngIf="order.teacher_accept_status == 'Declined'" class="cancel_tag">{{order.teacher_accept_status}}</span><span *ngIf="order.teacher_accept_status == 'Pending'" class="pending_tag">{{order.teacher_accept_status}}</span><span *ngIf="order.teacher_accept_status == 'Accepted'" class="success_tag">{{order.teacher_accept_status}}</span><br><br>
                                               <span style="color:black" *ngIf="order.teacher_accept_date_time != ''">{{order.teacher_accept_date_time}}</span>
                                               <span style="color:black" *ngIf="order.teacher_accept_date_time == null">N/A</span> 
                                            </td>
                                            <td>
                                                <b>Start:</b> {{ order?.booking_time }}<br>
                                                <b>End:</b> {{ order?.booking_end_time }}<br>
                                                {{ order?.class_name }} {{ order?.board_name }} {{ order?.subject }}
                                            </td>
                                            <td><a style="color:blue" [routerLink]="['/booking-details/', order.id  ]" >Pack Name: {{ order?.package.title }} <br> {{ order?.class_type }} For {{ order?.child_orders }} Days</a></td>
                                            <td>â‚¹{{ order?.total_amount }} | <span *ngIf="order.payment_status == 'Pending'" class="pending_tag">{{order.payment_status}}</span><span *ngIf="order.payment_status == 'Completed'" class="success_tag">{{order.payment_status}}</span><br><br>
                                                <span style="color:black" *ngIf="order.payment_date_time != ''">{{order.payment_date_time}}</span><span style="color:black" *ngIf="order.payment_date_time == null">N/A</span> </td>
                                            <td>{{ order.created_at }}</td>
                                            <td>
                                                <a style="cursor:pointer" (click)="deleteOrder(order.id)" class="action-btn" title="Delete"><span><img src="assets/images/delete-icon.png"></span></a>
                                            </td>
                                            
                                            
                                        </tr>
                                    
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 text-right bottom-paging">
                            <div class="paging_bootstrap pagination">
                                <pagination-controls (pageChange)="pageChangeEvent($event)"></pagination-controls>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="modalHeading">Create Booking</h4>
            </div>
            <div class="modal-body">
              <div>
                <div class="row">
                    <div class="saperate">Tutor Details</div><br>
                    <div class="col-sm-2 form-group">
                        <img *ngIf="selectedTutorImage" src="{{SiteUrl}}storage/users/{{selectedTutorImage}}" style="width: 70px;" />
                        <img  *ngIf="!selectedTutorImage" src="assets/images/avatar-pic.jpg" style="width: 70px;" />
                    </div>
                    <div class="col-sm-10 form-group" style="font-size: 15px;">
                        <b>Tutor Name:</b> {{selectedTutorName}}<br>
                        <b>Rating:</b> {{selectedTutorRating}}<br>
                        <b>Tutor Address:</b> {{selectedTutorAddress}}
                    </div>
                </div>
                <div class="row">    
                    <div class="col-sm-6 form-group">
                        <label>Teacher Phone <sup>*</sup></label>
                        <input type="text" (blur)="loadTeacherData()" id="teacher_phone" maxlength="10" class="form-control">
                    </div>
                    <div class="col-sm-3 form-group" style="padding-top:30px;text-align:center;">
                    --- OR ---
                    </div>
                    <div class="col-sm-3 form-group" style="padding-top:23px;text-align: right;">
                        <a data-toggle="modal" data-target="#tutorModal" class="btn btn-primary">Tutor Search</a>
                    </div>
                </div>
                <div class="row">
                    
                    <div class="saperate">Student Details</div><br>
                    <div class="col-sm-4 form-group">
                        <label>Student Name <sup>*</sup></label>
                        <input type="text" id="student_name" class="form-control">
                    </div>
                    <div class="col-sm-4 form-group">
                        <label>Student Email <sup>*</sup></label>
                        <input type="text" id="student_email" class="form-control">
                    </div>
                    <div class="col-sm-4 form-group">
                        <label>Student Phone <sup>*</sup></label>
                        <input type="text" id="student_phone" maxlength="10" class="form-control">
                    </div>
                    
                </div>
                <div class="row">
                    <div class="saperate">Booking Details</div><br>
                    <div class="col-sm-4 form-group">
                        <label>Subjects <sup>*</sup></label>
                        <select class="form-control" (change)="getPackages()" id="subject_id">
                            <option value="">Select</option>
                            <option *ngFor="let subject of subjects" value="{{ subject.id }}">{{ subject.title }}</option>
                        </select>
                    </div>
                    <div class="col-sm-4 form-group">
                        <label>Class <sup>*</sup></label>
                        <select class="form-control" (change)="getPackages()" id="class_id">
                            <option value="">Select</option>
                            <option *ngFor="let class of classes" value="{{ class.id }}">{{ class.title }}</option>
                        </select>
                    </div>
                    <div class="col-sm-4 form-group">
                        <label>Board <sup>*</sup></label>
                        <select class="form-control" (change)="getPackages()" id="board_id">
                            <option value="">Select</option>
                            <option *ngFor="let board of boards" value="{{ board.id }}">{{ board.title }}</option>
                        </select>
                    </div>
                    <div class="col-sm-4 form-group">
                        <label>Packages <sup>*</sup></label>
                        <select class="form-control" id="package_id">
                            <option value="">Select</option>
                            <option *ngFor="let package of packages" value="{{ package.id }}">{{ package.title }} | {{ package.price }} INR</option>
                        </select>
                    </div>
                    <div class="col-sm-4 form-group">
                        <label>Date Time <sup>*</sup></label>
                        <input type="datetime-local" id="booking_date_time" class="form-control">
                    </div>
                    <div class="col-sm-4 form-group">
                        <label>Custom Amount (Opt)</label>
                        <input type="text" id="custom_amt" class="form-control">
                    </div>
                </div>
                <div class="row">
                    <div class="saperate">OFF Days</div><br>
                    <div class="col-sm-12 form-group">
                        <input type="checkbox" id="Sunday" (change)="onChangeDays($event,'Sunday')" value="Sunday"> Sunday&nbsp;&nbsp;
                        <input type="checkbox" id="Monday" (change)="onChangeDays($event,'Monday')" value="Monday"> Monday&nbsp;&nbsp;
                        <input type="checkbox" id="Tuesday" (change)="onChangeDays($event,'Tuesday')" value="Tuesday"> Tuesday&nbsp;&nbsp;
                        <input type="checkbox" id="Wednesday" (change)="onChangeDays($event,'Wednesday')" value="Wednesday"> Wednesday&nbsp;&nbsp;
                        <input type="checkbox" id="Thursday" (change)="onChangeDays($event,'Thursday')" value="Thursday"> Thursday&nbsp;&nbsp;
                        <input type="checkbox" id="Friday" (change)="onChangeDays($event,'Friday')" value="Friday"> Friday&nbsp;&nbsp;
                        <input type="checkbox" id="Saturday" (change)="onChangeDays($event,'Saturday')" value="Saturday"> Saturday&nbsp;&nbsp;
                    </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" id="popCloseBtn" data-dismiss="modal">Close</button>
              <a id="createBookingBtn" (click)="createBooking()" class="btn btn-primary">Submit</a>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="tutorModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
        <div class="modal-dialog modal_tutors">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="modalHeading">Search Tutors</h4>
            </div>
            <div class="modal-body">
              <div>
                <div class="row">
                    
                    <div class="col-sm-2 form-group">
                        <select class="form-control" id="search_state_id" (change)="getCitiies()">
                            <option value="">Select State</option>
                            <option *ngFor="let state of stateList" id="{{state.id}}" value="{{ state.id }}">{{ state.state }}</option>
                        </select>
                    </div>
                    <div class="col-sm-2 form-group">
                        <select class="form-control" id="search_city_id">
                            <option value="">Select City</option>
                            <option *ngFor="let city of cityList" value="{{ city.id }}">{{ city.title }}</option>
                        </select>
                    </div>

                    <div class="col-sm-2 form-group">
                        <select class="form-control" id="search_class">
                            <option value="">Select Class</option>
                            <option *ngFor="let class of f_classes" value="{{ class.id }}">{{ class.title }}</option>
                            </select>
                    </div>

                    <div class="col-sm-2 form-group">
                        <select class="form-control" id="search_subjects">
                            <option value="">Select Subject</option>
                            <option *ngFor="let subject of f_subjects" value="{{ subject.id }}">{{ subject.title }}</option>
                            </select>
                    </div>

                    <div class="col-sm-2 form-group">
                        <select class="form-control" id="search_board">
                            <option value="">Select Board</option>
                            <option *ngFor="let board of f_boards" value="{{ board.id }}">{{ board.title }}</option>
                            </select>
                    </div>
                    
                    <div class="col-sm-2 form-group" style="text-align: right;"><a id="createBookingBtn" (click)="searchTutor()" class="btn btn-primary">Search</a></div>
                </div>
                <div class="row">
                    
                    <div class="col-sm-2 form-group">
                        <input type="text" class="form-control" id="search_tutor_name" placeholder="By Name">
                    </div>
                    <div class="col-sm-2 form-group">
                        <input type="text" class="form-control" id="search_tutor_email" placeholder="By Email">
                    </div>
                    <div class="col-sm-2 form-group">
                        <input type="text" class="form-control" id="search_tutor_phone" placeholder="By Phone">
                    </div>
                    <div class="col-sm-3 form-group">
                        <input type="text" class="form-control" id="search_tutor_address" placeholder="By Address">
                    </div>
                </div>
                <div class="row">
                <div class="col-sm-12">
                <div class="table-responsive widthFixed" style="height:400px">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th width="62px">S No.</th>
                            <th width="62px">DB ID</th>
                            <th width="183px">Profile Image</th>
                            <th width="142px">Name</th>
                            <th width="183px">Email Address</th>
                            <th width="120px">Mobile</th>
                            <th width="120px">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let user of f_tutors; let i = index" [attr.data-index]="i" class="odd">
                            <td>{{ i+1 }}.</td>
                            <td>{{ user.id }}</td>
                            <td><a *ngIf="user.profile_image" target="_blank" href="{{SiteUrl}}storage/users/{{user.profile_image}}"><img   src="{{SiteUrl}}storage/users/{{user.profile_image}}" style="width: 70px;" /></a>
                              <img  *ngIf="!user.profile_image" src="assets/images/avatar-pic.jpg" style="width: 70px;" /></td>
                            <td onmousedown="return false" onselectstart="return false">{{ user.name }}</td>
                            <td >{{ user.email }}</td>
                            <td onmousedown="return false" onselectstart="return false" >{{ user.phone }}</td>
                            <td><a (click)="selectTutor(user.phone)" data-dismiss="modal" class="btn btn-primary">Select</a></td>
                        </tr>
                    </tbody>
                </table>
                </div>
                </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" id="tutorPopupCloseBtn" data-dismiss="modal">Close</button>
              
            </div>
          </div>
        </div>
      </div>
</main>

<app-footer></app-footer>
